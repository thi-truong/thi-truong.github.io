<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Thi Truong">
<meta name="dcterms.date" content="2026-01-04">

<title>Use R and rayshader to make a 3-D Bathymetric Map of a Seamount Volcano</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="R-bathymetry-tutorial-kamaehu_files/libs/clipboard/clipboard.min.js"></script>
<script src="R-bathymetry-tutorial-kamaehu_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="R-bathymetry-tutorial-kamaehu_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="R-bathymetry-tutorial-kamaehu_files/libs/quarto-html/popper.min.js"></script>
<script src="R-bathymetry-tutorial-kamaehu_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="R-bathymetry-tutorial-kamaehu_files/libs/quarto-html/anchor.min.js"></script>
<link href="R-bathymetry-tutorial-kamaehu_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="R-bathymetry-tutorial-kamaehu_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="R-bathymetry-tutorial-kamaehu_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="R-bathymetry-tutorial-kamaehu_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="R-bathymetry-tutorial-kamaehu_files/libs/bootstrap/bootstrap-bb462d781dde1847d9e3ccf7736099dd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#summary" id="toc-summary" class="nav-link active" data-scroll-target="#summary"><span class="header-section-number">1</span> Summary</a>
  <ul class="collapse">
  <li><a href="#preview" id="toc-preview" class="nav-link" data-scroll-target="#preview"><span class="header-section-number">1.1</span> Preview</a></li>
  <li><a href="#credit" id="toc-credit" class="nav-link" data-scroll-target="#credit"><span class="header-section-number">1.2</span> Credit</a></li>
  </ul></li>
  <li><a href="#install-packages-for-3d-and-movie-rendering" id="toc-install-packages-for-3d-and-movie-rendering" class="nav-link" data-scroll-target="#install-packages-for-3d-and-movie-rendering"><span class="header-section-number">2</span> Install packages for 3D and movie rendering</a></li>
  <li><a href="#download-and-convert-bathymetry-data" id="toc-download-and-convert-bathymetry-data" class="nav-link" data-scroll-target="#download-and-convert-bathymetry-data"><span class="header-section-number">3</span> Download and convert bathymetry data</a>
  <ul class="collapse">
  <li><a href="#download-geotiff-files" id="toc-download-geotiff-files" class="nav-link" data-scroll-target="#download-geotiff-files"><span class="header-section-number">3.1</span> Download GeoTIFF files</a></li>
  <li><a href="#convert-geotiff-to-raster" id="toc-convert-geotiff-to-raster" class="nav-link" data-scroll-target="#convert-geotiff-to-raster"><span class="header-section-number">3.2</span> Convert GeoTIFF to Raster</a></li>
  <li><a href="#convert-raster-to-data-frame" id="toc-convert-raster-to-data-frame" class="nav-link" data-scroll-target="#convert-raster-to-data-frame"><span class="header-section-number">3.3</span> Convert Raster to Data Frame</a></li>
  </ul></li>
  <li><a href="#load-data-and-metadata-for-sample-locations" id="toc-load-data-and-metadata-for-sample-locations" class="nav-link" data-scroll-target="#load-data-and-metadata-for-sample-locations"><span class="header-section-number">4</span> Load data and metadata for sample locations</a>
  <ul class="collapse">
  <li><a href="#subset-location-data-for-dives-and-dredges" id="toc-subset-location-data-for-dives-and-dredges" class="nav-link" data-scroll-target="#subset-location-data-for-dives-and-dredges"><span class="header-section-number">4.1</span> Subset location data for dives and dredges</a>
  <ul class="collapse">
  <li><a href="#dives" id="toc-dives" class="nav-link" data-scroll-target="#dives"><span class="header-section-number">4.1.1</span> Dives</a></li>
  <li><a href="#dredges" id="toc-dredges" class="nav-link" data-scroll-target="#dredges"><span class="header-section-number">4.1.2</span> Dredges</a></li>
  </ul></li>
  <li><a href="#transform-dive-and-dredge-data-into-shapefile-objects" id="toc-transform-dive-and-dredge-data-into-shapefile-objects" class="nav-link" data-scroll-target="#transform-dive-and-dredge-data-into-shapefile-objects"><span class="header-section-number">4.2</span> Transform dive and dredge data into shapefile objects</a>
  <ul class="collapse">
  <li><a href="#dives-1" id="toc-dives-1" class="nav-link" data-scroll-target="#dives-1"><span class="header-section-number">4.2.1</span> Dives</a></li>
  <li><a href="#dredges-1" id="toc-dredges-1" class="nav-link" data-scroll-target="#dredges-1"><span class="header-section-number">4.2.2</span> Dredges</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#create-other-geospatial-objects" id="toc-create-other-geospatial-objects" class="nav-link" data-scroll-target="#create-other-geospatial-objects"><span class="header-section-number">5</span> Create other geospatial objects</a>
  <ul class="collapse">
  <li><a href="#contour-lines" id="toc-contour-lines" class="nav-link" data-scroll-target="#contour-lines"><span class="header-section-number">5.1</span> Contour lines</a></li>
  <li><a href="#bounding-box-for-a-cropped-region-to-display" id="toc-bounding-box-for-a-cropped-region-to-display" class="nav-link" data-scroll-target="#bounding-box-for-a-cropped-region-to-display"><span class="header-section-number">5.2</span> Bounding box for a cropped region to display</a></li>
  </ul></li>
  <li><a href="#create-maps" id="toc-create-maps" class="nav-link" data-scroll-target="#create-maps"><span class="header-section-number">6</span> Create Maps</a>
  <ul class="collapse">
  <li><a href="#map-1-classic-bathymetry-2-d" id="toc-map-1-classic-bathymetry-2-d" class="nav-link" data-scroll-target="#map-1-classic-bathymetry-2-d"><span class="header-section-number">6.1</span> Map 1: Classic Bathymetry (2-D)</a></li>
  <li><a href="#map-2-rayshader-3-dimensional" id="toc-map-2-rayshader-3-dimensional" class="nav-link" data-scroll-target="#map-2-rayshader-3-dimensional"><span class="header-section-number">6.2</span> Map 2: Rayshader 3-dimensional</a>
  <ul class="collapse">
  <li><a href="#animation" id="toc-animation" class="nav-link" data-scroll-target="#animation"><span class="header-section-number">6.2.1</span> Animation</a></li>
  <li><a href="#comparison-before-and-after-interpolation" id="toc-comparison-before-and-after-interpolation" class="nav-link" data-scroll-target="#comparison-before-and-after-interpolation"><span class="header-section-number">6.2.2</span> Comparison: Before and After Interpolation</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#closing-out" id="toc-closing-out" class="nav-link" data-scroll-target="#closing-out"><span class="header-section-number">7</span> Closing Out</a>
  <ul class="collapse">
  <li><a href="#resources" id="toc-resources" class="nav-link" data-scroll-target="#resources"><span class="header-section-number">7.1</span> Resources</a></li>
  <li><a href="#run-information" id="toc-run-information" class="nav-link" data-scroll-target="#run-information"><span class="header-section-number">7.2</span> Run Information</a></li>
  <li><a href="#forthcoming-improvements-and-ideas" id="toc-forthcoming-improvements-and-ideas" class="nav-link" data-scroll-target="#forthcoming-improvements-and-ideas"><span class="header-section-number">7.3</span> Forthcoming Improvements and Ideas</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Use R and rayshader to make a 3-D Bathymetric Map of a Seamount Volcano</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Thi Truong </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 4, 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="summary" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Summary</h1>
<p>This is a tutorial to use R package <a href="https://www.rayshader.com/index.html">rayshader</a> in a 3-D mapping workflow to visualize the appearance of an underwater volcano, and collection history of lava samples along the volcano over time. This example…</p>
<ol type="1">
<li>Combines multiple visualization types—points, lines, and a 3-D surface—into a single integrated map.</li>
<li>Uses data compiled from global datasets, primary literature, and shipboard reports, along with ongoing efforts to standardize decades of sample hauls with heterogeneous metadata.</li>
<li>Illustrates an approach that is transferable beyond underwater or volcanic settings, such as multimodal journey mapping in regions with complex topography.</li>
</ol>
<p>Jump to <a href="#create-maps"><strong>Create Maps</strong></a> to skip the data processing part of the tutorial.</p>
<section id="preview" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="preview"><span class="header-section-number">1.1</span> Preview</h2>
<p>I focus on <a href="https://www.usgs.gov/volcanoes/kama%E2%80%98ehuakanaloa">Kamaʻehuakanaloa</a>, a volcanic seamount off the coast of the island of Hawaiʻi. This volcano is ~10 km long with a summit ~900 meters below sea level, and the deepest portions extending below 5000 meters below sea level. I use data from <a href="https://www.gebco.net/">GEBCO (General Bathymetric Chart of the Oceans)</a> for the 3-D surface.</p>
<p>Here is a preview of what we will make:</p>
<p><img src="tutorial-images/summary_2d_3d.png" class="img-fluid" alt="3D bathymetry of a long volcanic landform visualized above a 2-D version where both have the same color scale to designate depth from 0 to 5km depth"></p>
</section>
<section id="credit" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="credit"><span class="header-section-number">1.2</span> Credit</h2>
<p>Huge thanks to resources and tutorials that I used while writing this tutorial:</p>
<ul>
<li><a href="https://www.rayshader.com/index.html">Rayshader website</a> by Tyler Morgan-Wall</li>
<li><a href="https://k-hench.github.io/kh/blog/code/2019-04-14-Rayshading-marmap/">Rayshader + Marmap</a> by Kosmas Hench (even though I did not use marmap here, working through this was useful and I hope to use overlays in future 3D maps)</li>
<li><a href="https://wcmbishop.github.io/rayshader-demo/">I can rayshade, and so can you</a> by wcmbishop</li>
</ul>
</section>
</section>
<section id="install-packages-for-3d-and-movie-rendering" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Install packages for 3D and movie rendering</h1>
<p>Even though these are not used until the very last step of the tutorial, we’ll first load packages useful for image editing and transforming raster to spatial data. Load devtools to download packages from github/developer (recommended).</p>
<p>Uncomment the lines for rayshader and rayimage for your initial install.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(devtools)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#devtools::install_github("tylermorganwall/rayshader")</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">#devtools::install_github("tylermorganwall/rayimage")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For the rest of the tutorial, we will load packages as needed. Install them if you do not have them already.</p>
</section>
<section id="download-and-convert-bathymetry-data" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Download and convert bathymetry data</h1>
<section id="download-geotiff-files" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="download-geotiff-files"><span class="header-section-number">3.1</span> Download GeoTIFF files</h2>
<p>See <a href="README.md"><strong>README.md</strong></a> for this tutorial. I have a couple files downloaded from <a href="https://download.gebco.net/">GEBCO Gridded Bathymetry Data</a> in the “<a href="/data/"><strong>data</strong></a>” folder.</p>
<p>These three files all have the same bounding box (extent):</p>
<ul>
<li>gebco24_kamaehu.tif, a GeoTiff file</li>
<li>gebco_kamaehu_relief.png, a shaded relief image</li>
<li>gebco24_kamaehu.png, a hillshade colour map</li>
</ul>
<p>The hillshade and relief are not much to look at (compared to land data). For this tutorial, we will only deal with the GeoTIFF.</p>
<p>We will get information about our raster data before we read that data into R.</p>
<p>Load <a href="https://rspatial.github.io/terra/">terra</a> package for the first functions we will use to deal with the .tif file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>describe()</code> function is used to get the properties of spatial data in a file, in this case, a downloaded . Then, we’ll store the output for future reference as <code>gebco24_kamaehu_info</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#describe("data/gebco24_kamaehu.tif")</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>gebco24_kamaehu_info <span class="ot">&lt;-</span> <span class="fu">capture.output</span>(<span class="fu">describe</span>(<span class="st">"data/gebco24_kamaehu.tif"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="convert-geotiff-to-raster" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="convert-geotiff-to-raster"><span class="header-section-number">3.2</span> Convert GeoTIFF to Raster</h2>
<p>Use terra function <code>rast()</code> to transform from geofile to raster (SpatRaster)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>kamaehu_raster <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"data/gebco24_kamaehu.tif"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="convert-raster-to-data-frame" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="convert-raster-to-data-frame"><span class="header-section-number">3.3</span> Convert Raster to Data Frame</h2>
<p>Then, convert raster to data frame. Set xy = TRUE to include the coordinates of each raster cell.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>kamaehu_raster_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(kamaehu_raster, <span class="at">xy =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>View information about coordinate reference system with <code>crs()</code> which is used to get the coordinate reference system. Set proj = TRUE to return crs in PROJ-string notation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get info about the coordinate reference system</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">crs</span>(kamaehu_raster, <span class="at">proj =</span> <span class="cn">TRUE</span>, <span class="at">describe =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    name authority code  area             extent
1 WGS 84      EPSG 4326 World -180, 180, -90, 90
                                 proj
1 +proj=longlat +datum=WGS84 +no_defs</code></pre>
</div>
</div>
<p>We find out that the datum is WGS84 and projected using longitude and latitude.</p>
<p>Check the range of cell values with terra’s <code>minmax()</code>. Returned empty/no result, so then we use <code>setMinMax()</code> to make the range and store the value. Then, we can check again.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set if no minmax returns</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>kamaehu_raster <span class="ot">&lt;-</span> <span class="fu">setMinMax</span>(kamaehu_raster)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># get min and max values</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">minmax</span>(kamaehu_raster)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    gebco24_kamaehu
min           -5183
max            -820</code></pre>
</div>
</div>
<p>We see that this range for this file is min: -5183, max: -820. These are in meters, by the way!</p>
</section>
</section>
<section id="load-data-and-metadata-for-sample-locations" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Load data and metadata for sample locations</h1>
<p>Load relevant packages to process and load the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Load data and metadata from <a href="https://ir.library.oregonstate.edu/concern/graduate_thesis_or_dissertations/rn301883z">Truong (2023)</a>, aka my dissertation. Use <code>read_csv()</code> to get sample locations. This file has 105 columns but we will use dplyr <code>select()</code> to only keep features related to location or collection. There are two main types of collection we consider here, and this influences the column selection:</p>
<ol type="1">
<li><p>Submarine dive (“dive”)<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. These are point locations with latitude, longitude, and depth.</p></li>
<li><p>Dredge haul (“dredge”)<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. These are technically lines but can be considered a point if needed.</p></li>
</ol>
<p>Read <a href="data/truong2023_kamaehu_data.csv"><strong>the csv file</strong></a>, which is compiled literature data from my PhD dissertation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read csv file, keep column names</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>kamaehu_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/truong2023_kamaehu_data.csv"</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">col_names =</span> <span class="cn">TRUE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 64 Columns: 105
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (14): sample_name, sample_name_ID, sample_name_short, rock_type, rock_ty...
dbl (88): sample_ID, rock_type_ID, x3He_4He_vesicle, x3He_4He_vesicle_2s, x3...
lgl  (3): rock_type_flag, depth_calc, lat_lon_calc

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>Read these columns. We select main metadata, and order them according to what I know which will be 1) dives, 2) dredge starts, and 3) dredge ends. Because I work with depth originally (meters below sea level), I am converting these to elevation, which is the same magnitude but is <em>above</em> sea level. Hence, we convert depth into elevation values (multiply by -1) so that they plot correctly.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>kamaehu_locations <span class="ot">&lt;-</span> kamaehu_data <span class="sc">|&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">elevation_m =</span> depth_m<span class="sc">*</span>(<span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">elevation_m_start =</span> depth_m_start<span class="sc">*</span>(<span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">elevation_m_end =</span> depth_m_end<span class="sc">*</span>(<span class="sc">-</span><span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(sample_ID, sample_name_short,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>           latitude, longitude, depth_m, elevation_m,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>           latitude_start, longitude_start,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>           depth_m_start, elevation_m_start, </span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>           latitude_end, longitude_end, depth_m_end,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>           elevation_m_end,</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>           collection, location, expedition,</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>           collection_type)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="subset-location-data-for-dives-and-dredges" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="subset-location-data-for-dives-and-dredges"><span class="header-section-number">4.1</span> Subset location data for dives and dredges</h2>
<p><code>kamaehu_locations</code> combines data from multiple collection types. For the purpose of visualizing the actual differences in collection, we will separate into points (dives and dredges).</p>
<section id="dives" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="dives"><span class="header-section-number">4.1.1</span> Dives</h3>
<p>These are <strong>points</strong> with a single collection coordinate (latitude, longitude) and depth because they are collected by a stationery ROV with a robot arm.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>kamaehu_locations_dive <span class="ot">&lt;-</span> kamaehu_locations <span class="sc">|&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(collection_type <span class="sc">==</span> <span class="st">"dive"</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(<span class="fu">c</span>(sample_ID, sample_name_short,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>            latitude, longitude, depth_m, elevation_m,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>            collection, location, expedition, collection_type))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="dredges" class="level3" data-number="4.1.2">
<h3 data-number="4.1.2" class="anchored" data-anchor-id="dredges"><span class="header-section-number">4.1.2</span> Dredges</h3>
<p>Select all the samples with dredge data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>kamaehu_locations_dredge <span class="ot">&lt;-</span> kamaehu_locations <span class="sc">|&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(collection_type <span class="sc">==</span> <span class="st">"dredge"</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(sample_ID, sample_name_short,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>           latitude_start, longitude_start,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>           depth_m_start, elevation_m_start, </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>           latitude_end, longitude_end, depth_m_end,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>           elevation_m_end, collection, location,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>           expedition, collection_type)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Dredge transects are lines extending from two points: 1) on-bottom 2) off-bottom (or close to it). While the actual dredge track is not a straight line during collection, we will map it as such as an approximation of the transect.</p>
<p><strong>Note: I could most likely filter out start and ends points later in the graph code, however, to minimize issues, I will separate the start and end points into different data sets:</strong></p>
<section id="start-points" class="level4" data-number="4.1.2.1">
<h4 data-number="4.1.2.1" class="anchored" data-anchor-id="start-points"><span class="header-section-number">4.1.2.1</span> Start points</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>kamaehu_locations_dredge_start <span class="ot">&lt;-</span> kamaehu_locations_dredge <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(sample_ID, sample_name_short,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>           latitude_start, longitude_start,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>           depth_m_start, elevation_m_start)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="end-points" class="level4" data-number="4.1.2.2">
<h4 data-number="4.1.2.2" class="anchored" data-anchor-id="end-points"><span class="header-section-number">4.1.2.2</span> End points</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>kamaehu_locations_dredge_end <span class="ot">&lt;-</span> kamaehu_locations_dredge <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(sample_ID, sample_name_short,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>           latitude_end, longitude_end,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>           depth_m_end, elevation_m_end)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="transform-dive-and-dredge-data-into-shapefile-objects" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="transform-dive-and-dredge-data-into-shapefile-objects"><span class="header-section-number">4.2</span> Transform dive and dredge data into shapefile objects</h2>
<p><strong>Note: From this point forward, there are several instances where I repeat code lines instead of defining functions, because things get weird and broken fast when I’m working with shapefiles or other mapping objects. I haven’t been able to troubleshoot this with seemingly MWEs. For now, my best bet has been to work with individual objects, even if it means repeating code unnecessarily. Once I figure it out, I will update this!</strong></p>
<p>sf objects are shapefiles. To turn these dive and dredge locations into something we can map, we’ll call in the sf package to map the latitude and longitude values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, use function <code>st_as_sf()</code> to convert data frame into an sf (shapefile) object. Use coords to indicate names and numbers of numeric columns holding coordinates. coordinate system for both: x = longitude, y = latitude.</p>
<p>Make sf objects, set coordinate reference system (CRS) for dive and dredge samples. In this case, I am using <a href="https://epsg.io/4326">WGS 84 (EPSG 4326)</a>. For your own data, you may work with a different datum depending on your region of focus or data source.</p>
<section id="dives-1" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="dives-1"><span class="header-section-number">4.2.1</span> Dives</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>kamaehu_locations_dive_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(kamaehu_locations_dive,</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>,<span class="st">"latitude"</span>),</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">crs =</span> <span class="st">"EPSG:4326"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Uncomment the below code to check the crs before or after to see if needed</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#crs(kamaehu_locations_dive_sf)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="dredges-1" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="dredges-1"><span class="header-section-number">4.2.2</span> Dredges</h3>
<p>Make sf objects, set crs for both dredge start and end points.</p>
<section id="start-points-1" class="level4" data-number="4.2.2.1">
<h4 data-number="4.2.2.1" class="anchored" data-anchor-id="start-points-1"><span class="header-section-number">4.2.2.1</span> Start points</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>kamaehu_locations_dredge_start_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(kamaehu_locations_dredge,</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude_start"</span>, <span class="st">"latitude_start"</span>),</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">crs =</span> <span class="st">"EPSG:4326"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="end-points-1" class="level4" data-number="4.2.2.2">
<h4 data-number="4.2.2.2" class="anchored" data-anchor-id="end-points-1"><span class="header-section-number">4.2.2.2</span> End points</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>kamaehu_locations_dredge_end_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(kamaehu_locations_dredge,</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude_end"</span>, <span class="st">"latitude_end"</span>),</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">crs =</span> <span class="st">"EPSG:4326"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
</section>
<section id="create-other-geospatial-objects" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Create other geospatial objects</h1>
<p>Load other helpful spatial packages because you’ll need it soon.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="contour-lines" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="contour-lines"><span class="header-section-number">5.1</span> Contour lines</h2>
<p>Going back to terra package to get contour lines from the raster we made, called <code>kamaehu_raster</code>.</p>
<p>Make contour from terra’s <code>rast()</code> not raster’s <code>raster()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>kamaehu_r <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"data/gebco24_kamaehu.tif"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Define contour levels (number of levels), make contour, then convert to sf object, then transform with the correct coordinate system. Not sure why I have both raster files <code>kamaehu_r</code> and <code>kamaehu_raster</code> but it’s not letting me get rid of the former.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>k_4_cr <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">as.contour</span>(kamaehu_r,</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>                            <span class="co">#1000-m increments when nlevels = 4</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">nlevels =</span> <span class="dv">4</span>) </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># change from SpatVector to sf object, set coordinates</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>k_4_cr_sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_as_sf</span>(k_4_cr,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">crs =</span> <span class="fu">crs</span>(kamaehu_raster))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>you can make a test plot with ggplot(k_[#]_lines) + geom_sf()</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(k_4_cr_sf) <span class="sc">+</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R-bathymetry-tutorial-kamaehu_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>An earlier rendition of this notebook indicated that contour lines bleed over into the edges of the 3D object in a rather ugly way, specifically on the top (North) and right (East) axes.</p>
<p><img src="tutorial-images//clipboard-1945740990.png" class="img-fluid"></p>
<p>I want to avoid black contour lines reaching the edges of the 3D shape. So, I want to limit contours to a region that is slightly smaller than the original bounding box, specifically with xmax (longitude max), and ymax (latitude max). I need to define a new bounding box and crop the contour lines to that box, while leaving everything else relatively the same.</p>
</section>
<section id="bounding-box-for-a-cropped-region-to-display" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="bounding-box-for-a-cropped-region-to-display"><span class="header-section-number">5.2</span> Bounding box for a cropped region to display</h2>
<p>This step will make the edges of the 3-D white, instead of what is seen above. If you do not mind the edges, then just make sure the contour object you map is the original one, <code>k_4_cr_sf</code>.</p>
<p>Get original extent from the raster package. Record the vector into 4 variables for xmin, xmax, ymin, ymax. It is VERY easy for me to confuse myself among naming them as latitude vs.&nbsp;longitude and min vs.&nbsp;max, so I have to check this a couple times to verify.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#check to make sure it as WGS84...</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">crs</span>(kamaehu_r) <span class="ot">&lt;-</span> <span class="st">"EPSG:4326"</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co">#define original raster data frame to get extent</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>orig_raster <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(kamaehu_r, <span class="at">xy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>orig_bbox <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"xmin_orig"</span>, <span class="st">"xmax_orig"</span>, <span class="st">"ymin_orig"</span>, <span class="st">"ymax_orig"</span>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co">#then assign extent(orig_raster[1:4] to the orig_bbox vector...</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="co">#define original bounding box coordinates</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>xmin_orig <span class="ot">&lt;-</span> <span class="fu">extent</span>(orig_raster)[<span class="dv">1</span>]</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>xmax_orig <span class="ot">&lt;-</span> <span class="fu">extent</span>(orig_raster)[<span class="dv">2</span>]</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>ymin_orig <span class="ot">&lt;-</span> <span class="fu">extent</span>(orig_raster)[<span class="dv">3</span>]</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>ymax_orig <span class="ot">&lt;-</span> <span class="fu">extent</span>(orig_raster)[<span class="dv">4</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Define a new bounding box and set a custom amount to remove on each edge. I just set them all the same because I am lazy (even though I know I am technically taking more of longitude than latitude). Use the <code>convert_coords()</code> function to define a new cropped bounding box, which keeps the crs. I found the function online but did not document the source (apologies!)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">#set absolute amount to remove on crop on all sides</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>crop_dif <span class="ot">&lt;-</span> <span class="fl">0.0005</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Crop to fit desired box for crop</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>lat_range <span class="ot">&lt;-</span> <span class="fu">c</span>(ymin_orig, ymax_orig<span class="sc">-</span>crop_dif)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>long_range <span class="ot">&lt;-</span> <span class="fu">c</span>(xmin_orig, xmax_orig<span class="sc">-</span>crop_dif)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co">#credit whoever made this function please</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>convert_coords <span class="ot">&lt;-</span> <span class="cf">function</span>(lat, long, <span class="at">from =</span> <span class="fu">CRS</span>(<span class="st">"+init=epsg:4326"</span>), to) {</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">long =</span> long, <span class="at">lat =</span> lat)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  sp<span class="sc">::</span><span class="fu">coordinates</span>(data) <span class="ot">&lt;-</span> <span class="er">~</span> long <span class="sc">+</span> lat</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  sp<span class="sc">::</span><span class="fu">proj4string</span>(data) <span class="ot">=</span> from</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert to coordinate system specified by EPSG code</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  xy <span class="ot">=</span> <span class="fu">data.frame</span>(sp<span class="sc">::</span><span class="fu">spTransform</span>(data, to))</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(xy) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"x"</span>,<span class="st">"y"</span>)</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">unlist</span>(xy))</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>crop_bbox <span class="ot">&lt;-</span> <span class="fu">convert_coords</span>(<span class="at">lat =</span> lat_range,</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>                           <span class="at">long =</span> long_range,</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>                           <span class="at">to =</span> <span class="fu">CRS</span>(<span class="st">"+init=epsg:4326"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in CPL_crs_from_input(x): GDAL Message 1: +init=epsg:XXXX syntax is
deprecated. It might return a CRS with a non-EPSG compliant axis order.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#get new, zoomed extent with cropped bounding box</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>extent_zoomed <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">extent</span>(crop_bbox[<span class="dv">1</span>], crop_bbox[<span class="dv">2</span>], </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>                                crop_bbox[<span class="dv">3</span>], crop_bbox[<span class="dv">4</span>])</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co">#make new raster of zoomed area</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>kamaehu_zoom_raster <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">crop</span>(kamaehu_raster, extent_zoomed)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co"># make new matrix of zoomed aea</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>kamaehu_zoom_matrix <span class="ot">&lt;-</span> rayshader<span class="sc">::</span><span class="fu">raster_to_matrix</span>(kamaehu_zoom_raster)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co"># make new data frame of zoomed area</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>kamaehu_zoom_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(kamaehu_zoom_matrix, <span class="at">xy =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, we generate contours the same way we did before, with the <code>as.contour()</code> function on the new raster file. Remember to add the word “zoom” to the variable names to avoid using the old information.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#1000-m increments, 5100-800 = 4300/4 = 1000</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>k_4_zoom_cr <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">as.contour</span>(kamaehu_zoom_raster, <span class="at">nlevels =</span> <span class="dv">4</span>) <span class="co">#1000-m increments</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># change from SpatVector to sf object, set coordinates</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>k_4_zoom_cr_sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_as_sf</span>(k_4_zoom_cr,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">crs =</span> <span class="fu">crs</span>(kamaehu_zoom_raster))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, we make a quick plot that shows the extent of the old bounding box (blue) and zoom/cropped region (red).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">#contour_zoom_diff_gg &lt;- </span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> k_4_cr_sf,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> k_4_zoom_cr_sf,</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">colour =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Change from crop diff: "</span>,</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> crop_dif,</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Blue is original extent, </span><span class="sc">\n</span><span class="st"> red is cropped extent"</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R-bathymetry-tutorial-kamaehu_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Woohoo! Now, I proceed with making a bunch of contour lines again.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#100-m increments, 5100-800 = 4300/43 = 100</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>k_43_zoom_cr <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">as.contour</span>(kamaehu_zoom_raster,</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">nlevels =</span> <span class="dv">43</span>) <span class="co">#100-m increments</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co"># change from SpatVector to sf object, set coordinates</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>k_43_zoom_cr_sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_as_sf</span>(k_43_zoom_cr,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">crs =</span> <span class="fu">crs</span>(kamaehu_zoom_raster))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="create-maps" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Create Maps</h1>
<p>First, load the rayshader package (installed in the first step), and the av package (used to make movies).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rayshader)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(av)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, we’re here.</p>
<section id="map-1-classic-bathymetry-2-d" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="map-1-classic-bathymetry-2-d"><span class="header-section-number">6.1</span> Map 1: Classic Bathymetry (2-D)</h2>
<p>Make quick ggplot, aka <code>quick_gg</code> (I’m annoyed by my naming choices, too). Note that in <code>geom_raster()</code>, the fill is the 3rd value of the raster file, aka height. I chose the turbo scale color option because it is the closest to the color scale options from the literature about this volcano.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>quick_gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="at">data =</span> kamaehu_raster_df ,</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> x,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y =</span> y,</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> gebco24_kamaehu),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">interpolate =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"turbo"</span>,</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">begin =</span> <span class="fl">0.1</span>,</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">end =</span> <span class="fl">0.9</span>,) <span class="sc">+</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#breaks = seq(from = -155.4, to = -155, by = 0.1)</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">155.4</span>,<span class="sc">-</span><span class="fl">155.3</span>,<span class="sc">-</span><span class="fl">155.2</span>,<span class="sc">-</span><span class="fl">155.1</span>, <span class="sc">-</span><span class="dv">155</span>)) <span class="sc">+</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot 1000-m contour</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> k_4_zoom_cr_sf,</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">linewidth =</span> <span class="fl">0.4</span>,</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot 100-m contour</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> k_43_zoom_cr_sf,</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>          <span class="at">linewidth =</span> <span class="fl">0.15</span>,</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot dive locations as filled circles</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> kamaehu_locations_dive_sf,</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="fl">1.5</span>,</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>          <span class="at">shape =</span> <span class="dv">23</span>,</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"yellow"</span>) <span class="sc">+</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot dredge segments as straight lines even though they're not</span></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> kamaehu_locations_dredge, </span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> longitude_start,</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xend =</span> longitude_end,</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> latitude_start,</span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>                   <span class="at">yend =</span> latitude_end),</span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>               <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>               <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot dredge start and end symbols as x</span></span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> kamaehu_locations_dredge_start_sf,</span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="fl">1.5</span>,</span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a>          <span class="at">shape =</span> <span class="dv">4</span>,</span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a>          <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> kamaehu_locations_dredge_end_sf,</span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a>          <span class="at">shape =</span> <span class="dv">4</span>,</span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a>          <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># use coordinate system 4326</span></span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">default_crs =</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(<span class="dv">4326</span>)) <span class="sc">+</span></span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set theme appearance</span></span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">color =</span> <span class="st">"white"</span>),</span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.box.just =</span> <span class="st">"right"</span>,</span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.25</span>)),</span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.6</span>)),</span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.25</span>))) <span class="sc">+</span></span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set axes and titles</span></span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Depth (mbsl, </span><span class="sc">\n</span><span class="st">meters below </span><span class="sc">\n</span><span class="st">sea level) </span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Longitude"</span>,</span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Latitude"</span>,</span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Selected dive and dredge sample locations, </span><span class="sc">\n</span><span class="st">Kamaʻehuakanaloa Seamount, Hawaiʻi </span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb35-59"><a href="#cb35-59" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Data sources: GEBCO 2024 Bathymetry grid, CRS = 4324, Moore et al., (1982), </span><span class="sc">\n</span><span class="st">Scripps Geological Data Center, JAMSTEC, Valbracht (1997), Garcia et al., unpublished </span><span class="sc">\n</span><span class="st"> </span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb35-60"><a href="#cb35-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-61"><a href="#cb35-61" aria-hidden="true" tabindex="-1"></a>quick_gg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R-bathymetry-tutorial-kamaehu_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="map-2-rayshader-3-dimensional" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="map-2-rayshader-3-dimensional"><span class="header-section-number">6.2</span> Map 2: Rayshader 3-dimensional</h2>
<p>The av package is used for the function <code>render_movie()</code> here. View with rayshader <code>plot_gg()</code>. Save snapshot and video.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_gg</span>(quick_gg, </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">multicore =</span> <span class="cn">TRUE</span>, <span class="at">offset_edges =</span> <span class="cn">TRUE</span>, <span class="at">raytrace =</span> <span class="cn">TRUE</span>,</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">width =</span> <span class="dv">6</span>, <span class="at">height =</span> <span class="dv">9</span>, <span class="at">scale =</span> <span class="dv">300</span>,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">windowsize =</span> <span class="fu">c</span>(<span class="dv">1400</span>, <span class="dv">1000</span>),</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">fov =</span> <span class="dv">0</span>, <span class="at">theta =</span> <span class="dv">45</span>, <span class="at">phi =</span> <span class="dv">60</span>, <span class="at">zoom =</span> <span class="fl">0.7</span>,</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">lambert =</span> <span class="cn">TRUE</span>, <span class="at">shadow =</span> <span class="cn">FALSE</span>, <span class="at">background =</span> <span class="st">"black"</span>,</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">sunangle =</span> <span class="dv">225</span>)</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="fu">render_snapshot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R-bathymetry-tutorial-kamaehu_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save as a png</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">render_snapshot</span>(<span class="at">filename =</span> <span class="st">"outputs/image/kamaehu_bathymetry_contours.png"</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># save as a video with 360 rotation</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="fu">render_movie</span>(<span class="at">filename =</span> <span class="st">"outputs/video/kamaehu_bathymetry_contours.mp4"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "C:\\Users\\Thi\\Documents\\Work PC Thi\\Documents\\R Learning\\rayshader-demo\\kamaehu_tutorial\\outputs\\video\\kamaehu_bathymetry_contours.mp4"</code></pre>
</div>
</div>
<section id="animation" class="level3" data-number="6.2.1">
<h3 data-number="6.2.1" class="anchored" data-anchor-id="animation"><span class="header-section-number">6.2.1</span> Animation</h3>
<p>This is what a typical movie looks like, in gif form:</p>
<p><img src="tutorial-images/kamaehu_bathymetry_contours_large.gif" class="img-fluid" alt="gif of rotating 3d bathymetry of kamaʻehuakanaloa seamount"></p>
</section>
<section id="comparison-before-and-after-interpolation" class="level3" data-number="6.2.2">
<h3 data-number="6.2.2" class="anchored" data-anchor-id="comparison-before-and-after-interpolation"><span class="header-section-number">6.2.2</span> Comparison: Before and After Interpolation</h3>
<p>When creating <a href="#map-1-classic-bathymetry-2-d">Map 1</a>, in <code>geom_raster()</code> we specify <code>interpolate = TRUE</code>. The below screenshot shows an earlier version when I had not yet interpolated the surface values. Notice the blocky texture here. Here, I also plotted dredge tracks as rectangles (more like ranges instead of tracks). I am not sure yet if that is more useful or not.</p>
<p><img src="tutorial-images/dive_dredge_schematic.png" class="img-fluid" alt="closeup of 3d visual with yellow dive points and rectangles indicating dredge ranges between start and stop"></p>
</section>
</section>
</section>
<section id="closing-out" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Closing Out</h1>
<section id="resources" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="resources"><span class="header-section-number">7.1</span> Resources</h2>
<p>See <a href="README.md"><strong>README.md</strong></a> for this tutorial.</p>
<p>Again, could not have wrote this without resources made by these folks:</p>
<ul>
<li><a href="https://www.rayshader.com/index.html">Rayshader website</a> by Tyler Morgan-Wall</li>
<li><a href="https://k-hench.github.io/kh/blog/code/2019-04-14-Rayshading-marmap/">Rayshader + Marmap</a> by Kosmas Hench (even though I did not use marmap here, working through this was useful and I hope to use overlays in future 3D maps)</li>
<li><a href="https://wcmbishop.github.io/rayshader-demo/">I can rayshade, and so can you</a> by wcmbishop</li>
</ul>
<p>Dissertation: <a href="https://ir.library.oregonstate.edu/concern/graduate_thesis_or_dissertations/rn301883z">Revisiting Lōʻihi: Geochemistry of Kamaʻehuakanaloa Lavas Reveals Complexities in the Pre-Shield to Shield Transition and Hawaiian Mantle Plume Source</a> (Appendix tables contain the location metadata)</p>
</section>
<section id="run-information" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="run-information"><span class="header-section-number">7.2</span> Run Information</h2>
<p>This was ran in RStudio and documented on a Quarto (.qmd) file in January 2026.</p>
<p>Version information:</p>
<blockquote class="blockquote">
<p>RStudio 2025.09.2+418 “Cucumberleaf Sunflower” Release (12f6d5e22720bd78dbd926bb344efe12d0dce83d, 2025-10-20) for windows Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) RStudio/2025.09.2+418 Chrome/138.0.7204.251 Electron/37.6.1 Safari/537.36, Quarto 1.7.32</p>
</blockquote>
<p>Quarto enables you to weave together content and executable code into a finished document. To learn more about Quarto see&nbsp;<a href="https://quarto.org/">https://quarto.org</a>.</p>
</section>
<section id="forthcoming-improvements-and-ideas" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="forthcoming-improvements-and-ideas"><span class="header-section-number">7.3</span> Forthcoming Improvements and Ideas</h2>
<ol type="1">
<li>Write reusable functions to reduce repetitive code and improve maintainability.</li>
<li>Map an example with elevation and a different datum, e.g.&nbsp;NAD83</li>
<li>Make a Reprex example with considerations for downloading from databases like GEBCO</li>
</ol>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Dives are insanely convenient. Well documented. Known depth, coordinates, even pictures/videos of the sites and exact collection, thanks to our robot friends. Highly precise, rewarding, but relatively little payload by volume and for the given time.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Dredge hauls may be the bane of a precise mapper’s existence. Dredge hauls are chain metal buckets dropped by a ship at the ocean bottom, which are dragged along a path along the ocean floor, picking up rocks until it is retrieved again. There are typically “start” and “stop” locations, but the rocks are collected between those moments. When I aggregate data, I still aim to preserve information about the whole dredge track.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>
